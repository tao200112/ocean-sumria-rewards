{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../services/store.tsx","../../../../types.ts","../../../../services/mockData.ts","../../../../services/api.ts","../../../../components/auth/AuthProvider.tsx","../../../../app/providers.tsx"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","import React, { createContext, useContext, useReducer, ReactNode, useEffect } from 'react';\nimport { User, Reward, PrizeConfig, ActivityLog, AppState, UserRole, SpinResult } from '../types';\nimport { MOCK_REWARDS, MOCK_PRIZES, MOCK_LOGS } from './mockData';\nimport { supabase } from './supabase';\nimport { api } from './api';\n\n// --- Types & Actions ---\ntype Action =\n  | { type: 'SET_USER'; payload: User | null }\n  | { type: 'UPDATE_USER_POINTS'; payload: { points: number; spins: number } }\n  | { type: 'ADD_LOG'; payload: ActivityLog }\n  | { type: 'ADD_REWARD'; payload: Reward }\n  | { type: 'MARK_REWARD_USED'; payload: string }\n  | { type: 'SET_LOADING'; payload: boolean }\n  | { type: 'SET_LOADING'; payload: boolean }\n  | { type: 'CLEAR_NEW_REWARD_FLAG' }\n  | { type: 'SET_LOGS'; payload: ActivityLog[] };\n\ninterface AppContextType {\n  state: AppState & { isLoading: boolean };\n  actions: {\n    logout: () => Promise<void>;\n    grantSpinsByPublicId: (staffId: string, publicId: string, billAmount: number) => Promise<{ success: boolean; message: string }>;\n    earnPoints: (staffId: string, publicId: string, billAmount: number) => Promise<{ success: boolean; message: string }>;\n    convertPointsToSpins: (customerId: string, spinsToBuy: number) => Promise<{ success: boolean; message: string }>;\n    spinWheel: (customerId: string) => Promise<SpinResult>;\n    redeemCoupon: (staffId: string, code: string) => Promise<boolean>;\n    clearNewRewardFlag: () => void;\n    // System Actions\n    setUser: (user: User | null) => void;\n    setLoading: (loading: boolean) => void;\n    setLogs: (logs: ActivityLog[]) => void;\n  };\n}\n\n// --- Initial State ---\nconst initialState: AppState & { isLoading: boolean } = {\n  currentUser: null,\n  activeRole: UserRole.UNKNOWN, // Start unknown\n  users: {}, // Only used for lookup cache in this version\n  rewards: MOCK_REWARDS,\n  logs: MOCK_LOGS,\n  prizes: MOCK_PRIZES,\n  lastCreatedRewardId: null,\n  isLoading: true,\n};\n\n// --- Reducer ---\nconst appReducer = (state: AppState & { isLoading: boolean }, action: Action): AppState & { isLoading: boolean } => {\n  const timestamp = new Date().toLocaleString();\n\n  switch (action.type) {\n    case 'SET_USER':\n      console.log('REDUCER: SET_USER', action.payload);\n      return {\n        ...state,\n        currentUser: action.payload,\n        activeRole: action.payload?.role || UserRole.CUSTOMER,\n        isLoading: false,\n      };\n\n    case 'SET_LOADING':\n      console.log('REDUCER: SET_LOADING', action.payload);\n      return { ...state, isLoading: action.payload };\n\n    case 'UPDATE_USER_POINTS':\n      if (!state.currentUser) return state;\n      return {\n        ...state,\n        currentUser: {\n          ...state.currentUser,\n          points: action.payload.points,\n          spins: action.payload.spins\n        }\n      };\n\n    case 'ADD_LOG':\n      return { ...state, logs: [action.payload, ...state.logs] };\n\n    case 'ADD_REWARD':\n      return {\n        ...state,\n        rewards: [action.payload, ...state.rewards],\n        lastCreatedRewardId: action.payload.id\n      };\n\n    case 'MARK_REWARD_USED':\n      return {\n        ...state,\n        rewards: state.rewards.map(r => r.code === action.payload ? { ...r, isUsed: true } : r)\n      };\n\n    case 'CLEAR_NEW_REWARD_FLAG':\n      return { ...state, rewards: state.rewards.map(r => ({ ...r, isNew: false })), lastCreatedRewardId: null };\n\n    case 'SET_LOGS':\n      return { ...state, logs: action.payload };\n\n    default:\n      return state;\n  }\n};\n\n// --- Provider ---\nconst AppContext = createContext<AppContextType | undefined>(undefined);\n\nexport const AppProvider = ({ children }: { children: ReactNode }) => {\n  const [state, dispatch] = useReducer(appReducer, initialState);\n\n  // --- Auth Listener ---\n  // Moved to AuthProvider to avoid race conditions and improve architecture\n  useEffect(() => {\n    // Initial state is loading\n    // AuthProvider will handle SET_USER and SET_LOADING\n  }, []);\n\n\n  // --- Actions (Async Wrappers around API) ---\n\n  // --- Actions (Async Wrappers around API) ---\n\n  const actions = React.useMemo(() => ({\n    logout: async () => {\n      await supabase.auth.signOut();\n      dispatch({ type: 'SET_USER', payload: null });\n    },\n    grantSpinsByPublicId: async (staffId: string, publicId: string, billAmount: number) => {\n      const res = await api.addPoints(staffId, publicId, billAmount);\n      if (res.success) {\n        dispatch({\n          type: 'ADD_LOG',\n          payload: {\n            id: `l-${Date.now()}`,\n            timestamp: new Date().toLocaleString(),\n            userId: staffId,\n            userName: 'Staff Member',\n            userAvatar: '',\n            action: 'EARN_POINTS',\n            details: `Earned ${res.pointsAdded} Points ($${billAmount.toFixed(2)})`,\n            publicId\n          }\n        });\n      }\n      return res;\n    },\n    earnPoints: async (staffId: string, publicId: string, billAmount: number) => {\n      // Just call logic directly since we can't self-reference easily in object literal init\n      const res = await api.addPoints(staffId, publicId, billAmount);\n      if (res.success) {\n        dispatch({\n          type: 'ADD_LOG',\n          payload: {\n            id: `l-${Date.now()}`,\n            timestamp: new Date().toLocaleString(),\n            userId: staffId,\n            userName: 'Staff Member',\n            userAvatar: '',\n            action: 'EARN_POINTS',\n            details: `Earned ${res.pointsAdded} Points ($${billAmount.toFixed(2)})`,\n            publicId\n          }\n        });\n      }\n      return res;\n    },\n    convertPointsToSpins: async (customerId: string, spinsToBuy: number) => {\n      const res = await api.convertPoints(customerId, spinsToBuy);\n      if (res.success && res.newPoints !== undefined && res.newSpins !== undefined) {\n        dispatch({ type: 'UPDATE_USER_POINTS', payload: { points: res.newPoints, spins: res.newSpins } });\n        dispatch({\n          type: 'ADD_LOG',\n          payload: {\n            id: `l-${Date.now()}`,\n            timestamp: new Date().toLocaleString(),\n            userId: customerId,\n            userName: 'Customer',\n            userAvatar: '',\n            action: 'CONVERT_POINTS',\n            details: `Converted points to ${spinsToBuy} Spins`\n          }\n        });\n      }\n      return res;\n    },\n    spinWheel: async (customerId: string): Promise<SpinResult> => {\n      const res = await api.spinWheel(customerId);\n      if (res.ok) {\n        // Use actual values from RPC response\n        if (res.newSpins !== undefined && res.newPoints !== undefined) {\n          dispatch({ type: 'UPDATE_USER_POINTS', payload: { points: res.newPoints, spins: res.newSpins } });\n        }\n        if (res.reward) {\n          dispatch({ type: 'ADD_REWARD', payload: { ...res.reward, isNew: true } });\n        }\n        dispatch({\n          type: 'ADD_LOG',\n          payload: {\n            id: `l-${Date.now()}`,\n            timestamp: new Date().toLocaleString(),\n            userId: customerId,\n            userName: 'Customer',\n            userAvatar: '',\n            action: 'SPIN',\n            details: `Result: ${res.prize?.name || 'No Win'}`,\n          }\n        });\n      }\n      return res as SpinResult;\n    },\n    redeemCoupon: async (staffId: string, code: string): Promise<boolean> => {\n      const success = await api.redeemCoupon(staffId, code);\n      if (success) {\n        dispatch({ type: 'MARK_REWARD_USED', payload: code });\n        dispatch({\n          type: 'ADD_LOG',\n          payload: {\n            id: `l-${Date.now()}`,\n            timestamp: new Date().toLocaleString(),\n            userId: staffId,\n            userName: 'Staff Member',\n            userAvatar: '',\n            action: 'REDEMPTION',\n            details: `Redeemed Coupon: ${code}`,\n          }\n        });\n      }\n      return success;\n    },\n    clearNewRewardFlag: () => dispatch({ type: 'CLEAR_NEW_REWARD_FLAG' }),\n    setUser: (user: User | null) => dispatch({ type: 'SET_USER', payload: user }),\n    setLoading: (loading: boolean) => dispatch({ type: 'SET_LOADING', payload: loading }),\n    setLogs: (logs: ActivityLog[]) => dispatch({ type: 'SET_LOGS', payload: logs })\n  }), [dispatch]); // Actions ONLY depend on dispatch, making them stable across renders.\n\n  // We need to fetch points/logs inside the actions if we want current state, \n  // but for the purpose of fixing the Infinite Loading, ensuring 'actions' object identity is stable is key.\n  // The 'earnPoints' logic referencing 'state' was removed or simplified. \n  // Original 'earnPoints' alias 'grantSpinsByPublicId' just called earnPoints.\n\n  // Re-implement earnPoints logic properly if it needed 'state'.\n  // Looking at original code: 'earnPoints' used 'state.currentUser.points'.\n  // To fix this without breaking stability: valid actions shouldn't rely on closure state.\n  // We'll rely on the API response or fresh fetch for strict correctness, or just ignore the optimistic calc for points for now.\n\n  return (\n    <AppContext.Provider value={{ state, actions }}>\n      {children}\n    </AppContext.Provider>\n  );\n};\n\nexport const useAppStore = () => {\n  const context = useContext(AppContext);\n  if (!context) throw new Error('useAppStore must be used within AppProvider');\n  return context;\n};","export enum UserRole {\n  UNKNOWN = 'UNKNOWN', // For initial loading state\n  CUSTOMER = 'CUSTOMER',\n  STAFF = 'STAFF',\n  ADMIN = 'ADMIN'\n}\n\nexport const normalizeRole = (role: string | null | undefined): UserRole => {\n  if (!role) return UserRole.CUSTOMER; // Default fallback for DB defaults\n  const normalized = role.toUpperCase().trim();\n  if (normalized === 'STAFF') return UserRole.STAFF;\n  if (normalized === 'ADMIN') return UserRole.ADMIN;\n  if (normalized === 'CUSTOMER') return UserRole.CUSTOMER;\n  return UserRole.CUSTOMER; // Safe default\n};\n\nexport interface User {\n  id: string;\n  publicId: string; // Unique 6-char ID for staff lookup (e.g., \"OS-9921\")\n  name: string;\n  email: string;\n  role: UserRole;\n  avatarUrl: string;\n  points?: number; // Customer only\n  spins?: number; // Customer only\n  joinedDate?: string;\n}\n\nexport interface Reward {\n  id: string;\n  title: string;\n  description: string;\n  expiryDate: string;\n  isUsed: boolean;\n  type: 'DISCOUNT' | 'FREE_ITEM' | 'BOGO';\n  code: string; // The QR code content\n  imageUrl: string;\n  isNew?: boolean; // To highlight newly won rewards\n}\n\nexport interface PrizeConfig {\n  id: string;\n  name: string;\n  weight: number; // Probability weight\n  totalAvailable: number | 'unlimited';\n  winLimit: string;\n  active: boolean;\n  icon: string;\n  color?: string; // For the wheel segment\n}\n\nexport interface ActivityLog {\n  id: string;\n  timestamp: string;\n  userId: string;\n  publicId?: string; // To show in logs\n  userName: string;\n  userAvatar: string;\n  action: 'SPIN' | 'REDEMPTION' | 'GRANT' | 'EARN_POINTS' | 'CONVERT_POINTS';\n  details: string; // \"Won 10% Off\" or \"Granted 3 spins\"\n  probabilityTier?: string;\n}\n\nexport interface SpinResult {\n  ok: boolean;\n  prize?: PrizeConfig;\n  reward?: Reward;\n  error?: string;\n  outcome?: 'WIN' | 'NO_WIN';\n}\n\nexport interface AppState {\n  currentUser: User | null;\n  activeRole: UserRole;\n  users: Record<string, User>; // Global registry of users\n  rewards: Reward[];\n  logs: ActivityLog[];\n  prizes: PrizeConfig[];\n  lastCreatedRewardId: string | null;\n}","import { User, UserRole, Reward, PrizeConfig, ActivityLog } from '../types';\n\n// --- Mock Users ---\nexport const MOCK_USERS: Record<string, User> = {\n  customer: {\n    id: 'c1',\n    publicId: 'OS-8X29',\n    name: 'Alex Johnson',\n    email: 'alex.j@example.com',\n    role: UserRole.CUSTOMER,\n    avatarUrl: 'https://picsum.photos/seed/alex/100/100',\n    points: 350,\n    spins: 2,\n    joinedDate: 'Oct 2023'\n  },\n  customer2: {\n    id: 'c2',\n    publicId: 'OS-331B',\n    name: 'Sarah Connor',\n    email: 'sarah.c@example.com',\n    role: UserRole.CUSTOMER,\n    avatarUrl: 'https://picsum.photos/seed/sarah/100/100',\n    points: 120,\n    spins: 0,\n    joinedDate: 'Nov 2023'\n  },\n  staff: {\n    id: 's1',\n    publicId: 'ST-001',\n    name: 'David Chen',\n    email: 'staff@oceansumria.com',\n    role: UserRole.STAFF,\n    avatarUrl: 'https://picsum.photos/seed/david/100/100'\n  },\n  admin: {\n    id: 'a1',\n    publicId: 'AD-001',\n    name: 'Sarah Owner',\n    email: 'admin@oceansumria.com',\n    role: UserRole.ADMIN,\n    avatarUrl: 'https://picsum.photos/seed/sarah/100/100'\n  }\n};\n\n// --- Mock Rewards (Customer Wallet) ---\nexport const MOCK_REWARDS: Reward[] = [\n  {\n    id: 'r1',\n    title: 'Free Calamari Appetizer',\n    description: 'Crispy, golden-fried calamari rings with marinara.',\n    expiryDate: '2023-10-24',\n    isUsed: false,\n    type: 'FREE_ITEM',\n    code: 'XC-992-00',\n    imageUrl: 'https://picsum.photos/seed/calamari/300/200'\n  },\n  {\n    id: 'r2',\n    title: 'Spicy Tuna Roll',\n    description: 'Fresh tuna with spicy mayo.',\n    expiryDate: '2023-11-01',\n    isUsed: false,\n    type: 'FREE_ITEM',\n    code: 'ST-112-99',\n    imageUrl: 'https://picsum.photos/seed/sushi/300/200'\n  },\n  {\n    id: 'r3',\n    title: '10% Off Total Bill',\n    description: 'Valid for dine-in only.',\n    expiryDate: '2023-10-20',\n    isUsed: true,\n    type: 'DISCOUNT',\n    code: '10-OFF-OLD',\n    imageUrl: 'https://picsum.photos/seed/discount/300/200'\n  }\n];\n\n// --- Mock Prize Configuration (Admin) ---\nexport const MOCK_PRIZES: PrizeConfig[] = [\n  { id: 'p1', name: 'Free Burger', weight: 10, totalAvailable: 500, winLimit: '1/day', active: false, icon: 'lunch_dining', color: '#f2a60d' },\n  { id: 'p2', name: '10% Off', weight: 50, totalAvailable: 'unlimited', winLimit: 'None', active: true, icon: 'local_offer', color: '#3b82f6' },\n  { id: 'p3', name: 'Mystery Box', weight: 5, totalAvailable: 10, winLimit: '1/user', active: true, icon: 'inventory_2', color: '#8b5cf6' },\n  { id: 'p4', name: 'Free Drink', weight: 80, totalAvailable: 'unlimited', winLimit: 'None', active: true, icon: 'local_bar', color: '#10b981' },\n  // Adding a logic-only prize for \"No Win\" if weights don't add up, or explicit lose\n  { id: 'p_lose', name: 'Better Luck Next Time', weight: 20, totalAvailable: 'unlimited', winLimit: 'None', active: true, icon: 'mood_bad', color: '#64748b' }\n];\n\n// --- Mock Activity Logs ---\nexport const MOCK_LOGS: ActivityLog[] = [\n  {\n    id: 'l1',\n    timestamp: '2023-10-24 10:42 AM',\n    userId: 'c1',\n    publicId: 'OS-8X29',\n    userName: 'Alex Johnson',\n    userAvatar: 'https://picsum.photos/seed/alex/50/50',\n    action: 'SPIN',\n    details: 'Won Free Drink',\n    probabilityTier: 'Tier 3'\n  },\n  {\n    id: 'l2',\n    timestamp: '2023-10-24 09:15 AM',\n    userId: 'c2',\n    publicId: 'OS-331B',\n    userName: 'Sarah Connor',\n    userAvatar: 'https://picsum.photos/seed/alice/50/50',\n    action: 'REDEMPTION',\n    details: 'Redeemed 10% Off',\n  },\n  {\n    id: 'l3',\n    timestamp: '2023-10-23 04:30 PM',\n    userId: 's1',\n    userName: 'David Chen',\n    userAvatar: 'https://picsum.photos/seed/david/50/50',\n    action: 'EARN_POINTS',\n    details: 'Earned 105 Points ($105.00 Bill)',\n  },\n  {\n    id: 'l4',\n    timestamp: '2023-10-23 05:00 PM',\n    userId: 'c1',\n    publicId: 'OS-8X29',\n    userName: 'Alex Johnson',\n    userAvatar: 'https://picsum.photos/seed/alex/50/50',\n    action: 'CONVERT_POINTS',\n    details: 'Converted 200 pts to 2 Spins',\n  }\n];","import { supabase } from './supabase';\nimport { User, UserRole, ActivityLog, SpinResult, normalizeRole, Reward } from '../types';\nimport { MOCK_PRIZES } from './mockData'; // Keeping for fallback or types if needed, but logic is server side now\n\n/**\n * API Facade\n * \n * Connecting to Next.js API Routes.\n */\n\n// Utility: Timeout wrapper\nconst withTimeout = (promise: Promise<any>, ms: number, label: string) => {\n  return new Promise((resolve, reject) => {\n    const timer = setTimeout(() => {\n      console.warn(`[API] Timeout: ${label} took longer than ${ms}ms`);\n      reject(new Error(`Timeout: ${label}`));\n    }, ms);\n\n    promise\n      .then(res => {\n        clearTimeout(timer);\n        resolve(res);\n      })\n      .catch(err => {\n        clearTimeout(timer);\n        reject(err);\n      });\n  });\n};\n\nexport const api = {\n  /**\n   * Fetch User Profile with STRICT Handling\n   * GET /api/auth/me\n   */\n  fetchProfile: async (userId: string, email: string): Promise<User | null> => {\n    let attempts = 0;\n    while (attempts < 5) {\n      try {\n        // Use RPC for reliability (bypasses complex RLS)\n        const { data, error } = await supabase.rpc('rpc_get_my_profile');\n\n        if (error) {\n          console.warn(`[API] fetchProfile RPC error (attempt ${attempts}):`, error.message);\n        } else if (data && !data.error) {\n          // Found it!\n          return {\n            id: data.id,\n            publicId: data.public_id,\n            name: data.name || email.split('@')[0],\n            email: data.email || email,\n            role: normalizeRole(data.role),\n            avatarUrl: `https://ui-avatars.com/api/?name=${data.email}&background=random`,\n            points: data.points || 0,\n            spins: data.spins || 0,\n            joinedDate: new Date().toLocaleDateString()\n          };\n        } else if (data?.error) {\n          console.log(`[API] RPC returned error: ${data.error}, retrying... ${attempts + 1}/5`);\n        } else {\n          console.log(`[API] Profile missing, retrying... ${attempts + 1}/5`);\n        }\n      } catch (e) {\n        console.error(`[API] fetchProfile attempt ${attempts} crash:`, e);\n      }\n\n      // Short delay between retries\n      await new Promise(r => setTimeout(r, 800));\n      attempts++;\n    }\n\n    console.error('[API] fetchProfile failed after 5 attempts.');\n    return null;\n  },\n\n  /**\n   * ensureProfile: READ ONLY.\n   * We DO NOT create profiles on client anymore.\n   * If usage calls this, we just fetch.\n   */\n  ensureProfile: async (user: any) => {\n    // Just an alias for direct fetch now, wait for trigger\n    let attempts = 0;\n    while (attempts < 5) {\n      const { data, error } = await supabase.from('profiles').select('*').eq('id', user.id).maybeSingle();\n      if (data) return data;\n      if (error) console.warn('Profile fetch error:', error);\n\n      // Wait 1s for trigger\n      await new Promise(r => setTimeout(r, 1000));\n      attempts++;\n    }\n    return null;\n  },\n\n  // --- RPC Wrappers ---\n\n  staffGetCustomer: async (publicId: string) => {\n    const { data, error } = await supabase.rpc('rpc_staff_get_customer_by_public_id', { public_id_query: publicId });\n    if (error) return { found: false, error: error.message };\n    return data; // { found: true, profile: ... }\n  },\n\n  staffAddPoints: async (publicId: string, amountCents: number) => {\n    const { data, error } = await supabase.rpc('rpc_staff_add_points', {\n      public_id_query: publicId,\n      bill_amount_cents: amountCents,\n      receipt_ref: 'manual'\n    });\n    if (error) return { status: 'error', message: error.message };\n    return data;\n  },\n\n  // Mapping old actions to RPCs where possible\n  // ... (Other existing methods) ...\n\n  /**\n   * Staff: Add Points to Customer\n   * POST /api/staff/add-points\n   */\n  addPoints: async (staffId: string, customerPublicId: string, billAmount: number) => {\n    try {\n      const res = await fetch('/api/staff/add-points', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ publicId: customerPublicId, billAmountCents: Math.round(billAmount * 100), receiptRef: `REF-${Date.now()}` })\n      });\n      const json = await res.json();\n      if (!res.ok) return { success: false, message: json.error };\n\n      return { success: true, message: `Added points successfully`, pointsAdded: json.data.new_points };\n    } catch (e) {\n      return { success: false, message: (e as Error).message };\n    }\n  },\n\n  /**\n   * Customer: Convert Points to Spins\n   * POST /api/customer/convert-points\n   */\n  convertPoints: async (customerId: string, spinsToBuy: number) => {\n    try {\n      console.log('[API] Converting points via RPC, spins:', spinsToBuy);\n      const { data, error } = await supabase.rpc('rpc_convert_points_to_spins', {\n        p_spin_count: spinsToBuy\n      });\n\n      console.log('[API] Convert result:', data, error);\n\n      if (error) {\n        return { success: false, message: error.message };\n      }\n\n      if (data?.success === false) {\n        return { success: false, message: data.error || 'Conversion failed' };\n      }\n\n      return {\n        success: true,\n        message: `Converted ${data.points_spent} points to ${data.spins_added} spins`,\n        newPoints: data.new_points,\n        newSpins: data.new_spins\n      };\n    } catch (e) {\n      console.error('[API] convertPoints error:', e);\n      return { success: false, message: (e as Error).message };\n    }\n  },\n\n  /**\n   * Customer: Spin the Wheel\n   * POST /api/customer/spin\n   */\n  spinWheel: async (customerId: string) => {\n    try {\n      console.log('[API] Spinning wheel via RPC...');\n      const { data, error } = await supabase.rpc('rpc_spin');\n\n      console.log('[API] Spin result:', data, error);\n\n      if (error) {\n        return { ok: false, error: error.message };\n      }\n\n      if (!data?.ok) {\n        return { ok: false, error: data?.error || 'Spin failed' };\n      }\n\n      const { outcome, prize, coupon_code, spins, points } = data;\n\n      let reward: Reward | undefined;\n      if (outcome === 'WIN' && prize) {\n        reward = {\n          id: coupon_code || 'temp',\n          title: prize.name,\n          description: prize.value || 'Prize Reward',\n          expiryDate: '7 days',\n          isUsed: false,\n          type: prize.type === 'discount' ? 'DISCOUNT' : 'FREE_ITEM',\n          code: coupon_code,\n          imageUrl: 'https://picsum.photos/seed/win/300/200',\n          isNew: true\n        };\n      }\n\n      return {\n        ok: true,\n        prize: prize || null,\n        reward,\n        outcome: outcome,\n        newSpins: spins,\n        newPoints: points\n      };\n    } catch (e) {\n      console.error('[API] spinWheel error:', e);\n      return { ok: false, error: (e as Error).message };\n    }\n  },\n\n  /**\n   * Staff: Redeem Coupon\n   * POST /api/staff/redeem\n   */\n  redeemCoupon: async (staffId: string, code: string) => {\n    try {\n      const res = await fetch('/api/staff/redeem', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ code })\n      });\n      const json = await res.json();\n      return json.ok;\n    } catch (e) {\n      console.error(e);\n      return false;\n    }\n  },\n\n  /**\n   * Admin: Fetch Logs\n   * GET /api/admin/audit-logs\n   */\n  getLogs: async () => {\n    try {\n      const res = await fetch('/api/admin/audit-logs');\n      const json = await res.json();\n      if (!res.ok) return [];\n\n      // Map to frontend ActivityLog type\n      return json.data.map((log: any) => ({\n        id: log.id,\n        timestamp: new Date(log.created_at).toLocaleString(),\n        userId: log.actor_id,\n        userName: log.profiles?.name || 'Unknown',\n        userAvatar: '',\n        action: log.type,\n        details: JSON.stringify(log.metadata)\n      }));\n    } catch (e) {\n      console.error(e);\n      return [];\n    }\n  },\n\n  /**\n   * Admin: Publish Prize Pool\n   * POST /api/admin/pool/publish\n   */\n  publishPool: async (poolVersionId: string) => {\n    try {\n      const res = await fetch('/api/admin/pool/publish', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ poolVersionId })\n      });\n      const json = await res.json();\n      return { success: res.ok, message: json.ok ? 'Published' : json.error };\n    } catch (e) {\n      return { success: false, message: (e as Error).message };\n    }\n  }\n};","'use client';\r\n\r\nimport React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport { supabase } from '@/services/supabase';\r\nimport { useAppStore } from '@/services/store';\r\nimport { api } from '@/services/api';\r\nimport { UserRole, normalizeRole } from '@/types';\r\n\r\ninterface AuthContextType {\r\n    loading: boolean;\r\n    session: any;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType>({ loading: true, session: null });\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n\r\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\r\n    const { actions } = useAppStore();\r\n    const [session, setSession] = useState<any>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [initialized, setInitialized] = useState(false);\r\n\r\n    // Single initialization effect\r\n    useEffect(() => {\r\n        if (initialized) return;\r\n        setInitialized(true);\r\n\r\n        console.log('[Auth] Initializing...');\r\n\r\n        const initAuth = async () => {\r\n            try {\r\n                // 1. Get current session\r\n                const { data: { session: currentSession }, error } = await supabase.auth.getSession();\r\n\r\n                if (error) {\r\n                    console.error('[Auth] getSession error:', error);\r\n                    setLoading(false);\r\n                    actions.setLoading(false);\r\n                    return;\r\n                }\r\n\r\n                setSession(currentSession);\r\n\r\n                if (currentSession?.user) {\r\n                    console.log('[Auth] Session found, fetching profile for:', currentSession.user.id);\r\n                    await loadProfile(currentSession.user);\r\n                } else {\r\n                    console.log('[Auth] No session');\r\n                    actions.setUser(null);\r\n                    setLoading(false);\r\n                    actions.setLoading(false);\r\n                }\r\n            } catch (e) {\r\n                console.error('[Auth] Init error:', e);\r\n                setLoading(false);\r\n                actions.setLoading(false);\r\n            }\r\n        };\r\n\r\n        // Listen for auth changes\r\n        const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event: string, newSession: any) => {\r\n            console.log('[Auth] Event:', event);\r\n            setSession(newSession);\r\n\r\n            if (event === 'SIGNED_IN' && newSession?.user) {\r\n                console.log('[Auth] SIGNED_IN, loading profile...');\r\n                await loadProfile(newSession.user);\r\n            } else if (event === 'SIGNED_OUT') {\r\n                console.log('[Auth] SIGNED_OUT');\r\n                actions.setUser(null);\r\n                setLoading(false);\r\n                actions.setLoading(false);\r\n            }\r\n        });\r\n\r\n        initAuth();\r\n\r\n        return () => {\r\n            subscription.unsubscribe();\r\n        };\r\n    }, [initialized, actions]);\r\n\r\n    // Profile loader function\r\n    const loadProfile = async (user: any) => {\r\n        console.log('[Auth] loadProfile called for:', user.id, user.email);\r\n        setLoading(true);\r\n        actions.setLoading(true);\r\n\r\n        // Hard timeout protection\r\n        const timeout = setTimeout(() => {\r\n            console.error('[Auth] Profile load timeout - unlocking UI');\r\n            setLoading(false);\r\n            actions.setLoading(false);\r\n        }, 8000);\r\n\r\n        try {\r\n            // Try RPC first\r\n            console.log('[Auth] Calling rpc_get_my_profile...');\r\n            const { data: rpcData, error: rpcError } = await supabase.rpc('rpc_get_my_profile');\r\n\r\n            clearTimeout(timeout);\r\n            console.log('[Auth] RPC result:', { data: rpcData, error: rpcError });\r\n\r\n            if (rpcError) {\r\n                console.error('[Auth] RPC error:', rpcError.message);\r\n                // Try direct query as fallback\r\n                console.log('[Auth] Trying direct query...');\r\n                const { data: directData, error: directError } = await supabase\r\n                    .from('profiles')\r\n                    .select('*')\r\n                    .eq('id', user.id)\r\n                    .single();\r\n\r\n                console.log('[Auth] Direct query result:', { data: directData, error: directError });\r\n\r\n                if (directData) {\r\n                    const profile = {\r\n                        id: directData.id,\r\n                        publicId: directData.public_id,\r\n                        name: directData.name || user.email?.split('@')[0],\r\n                        email: directData.email || user.email,\r\n                        role: normalizeRole(directData.role),\r\n                        avatarUrl: `https://ui-avatars.com/api/?name=${directData.email}&background=random`,\r\n                        points: directData.points || 0,\r\n                        spins: directData.spins || 0,\r\n                        joinedDate: new Date().toLocaleDateString()\r\n                    };\r\n                    console.log('[Auth] Profile loaded via direct query:', profile.publicId);\r\n                    actions.setUser(profile);\r\n                } else {\r\n                    console.error('[Auth] No profile found!');\r\n                    alert('Profile not found. Please contact support.');\r\n                    await supabase.auth.signOut();\r\n                    actions.setUser(null);\r\n                }\r\n            } else if (rpcData && !rpcData.error) {\r\n                const profile = {\r\n                    id: rpcData.id,\r\n                    publicId: rpcData.public_id,\r\n                    name: rpcData.name || user.email?.split('@')[0],\r\n                    email: rpcData.email || user.email,\r\n                    role: normalizeRole(rpcData.role),\r\n                    avatarUrl: `https://ui-avatars.com/api/?name=${rpcData.email}&background=random`,\r\n                    points: rpcData.points || 0,\r\n                    spins: rpcData.spins || 0,\r\n                    joinedDate: new Date().toLocaleDateString()\r\n                };\r\n                console.log('[Auth] Profile loaded via RPC:', profile.publicId, profile.role);\r\n                actions.setUser(profile);\r\n            } else {\r\n                console.error('[Auth] RPC returned error:', rpcData?.error);\r\n                alert('Profile not found. Please try signing in again.');\r\n                await supabase.auth.signOut();\r\n                actions.setUser(null);\r\n            }\r\n        } catch (e) {\r\n            console.error('[Auth] loadProfile exception:', e);\r\n            actions.setUser(null);\r\n        } finally {\r\n            setLoading(false);\r\n            actions.setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={{ loading, session }}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n","'use client'\r\nimport { AppProvider } from '@/services/store'\r\nimport { AuthProvider } from '@/components/auth/AuthProvider'\r\n\r\nexport function Providers({ children }: { children: React.ReactNode }) {\r\n    return (\r\n        <AppProvider>\r\n            <AuthProvider>\r\n                {children}\r\n            </AuthProvider>\r\n        </AppProvider>\r\n    )\r\n}\r\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","vendored","ReactJsxRuntime","React"],"mappings":"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","ignoreList":[0,1,2]}