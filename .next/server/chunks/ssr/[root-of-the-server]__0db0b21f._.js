module.exports=[43285,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/dynamic-access-async-storage.external.js",()=>require("next/dist/server/app-render/dynamic-access-async-storage.external.js"))},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},35112,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactDOM},51234,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"HandleISRError",{enumerable:!0,get:function(){return e}});let d=a.r(56704).workAsyncStorage;function e({error:a}){if(d){let b=d.getStore();if(b?.isStaticGeneration)throw a&&console.error(a),a}return null}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},40622,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return h}});let d=a.r(87924),e=a.r(51234),f={fontFamily:'system-ui,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji"',height:"100vh",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},g={fontSize:"14px",fontWeight:400,lineHeight:"28px",margin:"0 8px"},h=function({error:a}){let b=a?.digest;return(0,d.jsxs)("html",{id:"__next_error__",children:[(0,d.jsx)("head",{}),(0,d.jsxs)("body",{children:[(0,d.jsx)(e.HandleISRError,{error:a}),(0,d.jsx)("div",{style:f,children:(0,d.jsxs)("div",{children:[(0,d.jsxs)("h2",{style:g,children:["Application error: a ",b?"server":"client","-side exception has occurred while loading ",window.location.hostname," (see the"," ",b?"server logs":"browser console"," for more information)."]}),b?(0,d.jsx)("p",{style:g,children:`Digest: ${b}`}):null]})})]})]})};("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},25792,a=>{"use strict";var b,c=a.i(87924),d=a.i(72131),e=((b={}).UNKNOWN="UNKNOWN",b.CUSTOMER="CUSTOMER",b.STAFF="STAFF",b.ADMIN="ADMIN",b);let f=a=>{if(!a)return"CUSTOMER";let b=a.toUpperCase().trim();return"STAFF"===b?"STAFF":"ADMIN"===b?"ADMIN":"CUSTOMER"};e.CUSTOMER,e.CUSTOMER,e.STAFF,e.ADMIN;var g=a.i(66232);let h=async(a,b,c)=>{try{let a=await fetch("/api/staff/add-points",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({publicId:b,billAmountCents:Math.round(100*c),receiptRef:`REF-${Date.now()}`})}),d=await a.json();if(!a.ok)return{success:!1,message:d.error};return{success:!0,message:"Added points successfully",pointsAdded:d.data.new_points}}catch(a){return{success:!1,message:a.message}}},i=async(a,b)=>{try{console.log("[API] Converting points via RPC, spins:",b);let{data:a,error:c}=await g.supabase.rpc("rpc_convert_points_to_spins",{p_spin_count:b});if(console.log("[API] Convert result:",a,c),c)return{success:!1,message:c.message};if(a?.success===!1)return{success:!1,message:a.error||"Conversion failed"};return{success:!0,message:`Converted ${a.points_spent} points to ${a.spins_added} spins`,newPoints:a.new_points,newSpins:a.new_spins}}catch(a){return console.error("[API] convertPoints error:",a),{success:!1,message:a.message}}},j=async a=>{try{let a;console.log("[API] Spinning wheel via RPC...");let{data:b,error:c}=await g.supabase.rpc("rpc_spin");if(console.log("[API] Spin result:",b,c),c)return{ok:!1,error:c.message};if(!b?.ok)return{ok:!1,error:b?.error||"Spin failed"};let{outcome:d,prize:e,coupon_code:f,spins:h,points:i}=b;return"WIN"===d&&e&&(a={id:f||"temp",title:e.name,description:e.value||"Prize Reward",expiryDate:"7 days",isUsed:!1,type:"discount"===e.type?"DISCOUNT":"FREE_ITEM",code:f,imageUrl:"https://picsum.photos/seed/win/300/200",isNew:!0}),{ok:!0,prize:e||null,reward:a,outcome:d,newSpins:h,newPoints:i}}catch(a){return console.error("[API] spinWheel error:",a),{ok:!1,error:a.message}}},k=async(a,b)=>{try{let a=await fetch("/api/staff/redeem",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:b})});return(await a.json()).ok}catch(a){return console.error(a),!1}},l={currentUser:null,activeRole:e.UNKNOWN,users:{},rewards:[{id:"r1",title:"Free Calamari Appetizer",description:"Crispy, golden-fried calamari rings with marinara.",expiryDate:"2023-10-24",isUsed:!1,type:"FREE_ITEM",code:"XC-992-00",imageUrl:"https://picsum.photos/seed/calamari/300/200"},{id:"r2",title:"Spicy Tuna Roll",description:"Fresh tuna with spicy mayo.",expiryDate:"2023-11-01",isUsed:!1,type:"FREE_ITEM",code:"ST-112-99",imageUrl:"https://picsum.photos/seed/sushi/300/200"},{id:"r3",title:"10% Off Total Bill",description:"Valid for dine-in only.",expiryDate:"2023-10-20",isUsed:!0,type:"DISCOUNT",code:"10-OFF-OLD",imageUrl:"https://picsum.photos/seed/discount/300/200"}],logs:[{id:"l1",timestamp:"2023-10-24 10:42 AM",userId:"c1",publicId:"OS-8X29",userName:"Alex Johnson",userAvatar:"https://picsum.photos/seed/alex/50/50",action:"SPIN",details:"Won Free Drink",probabilityTier:"Tier 3"},{id:"l2",timestamp:"2023-10-24 09:15 AM",userId:"c2",publicId:"OS-331B",userName:"Sarah Connor",userAvatar:"https://picsum.photos/seed/alice/50/50",action:"REDEMPTION",details:"Redeemed 10% Off"},{id:"l3",timestamp:"2023-10-23 04:30 PM",userId:"s1",userName:"David Chen",userAvatar:"https://picsum.photos/seed/david/50/50",action:"EARN_POINTS",details:"Earned 105 Points ($105.00 Bill)"},{id:"l4",timestamp:"2023-10-23 05:00 PM",userId:"c1",publicId:"OS-8X29",userName:"Alex Johnson",userAvatar:"https://picsum.photos/seed/alex/50/50",action:"CONVERT_POINTS",details:"Converted 200 pts to 2 Spins"}],prizes:[{id:"p1",name:"Free Burger",weight:10,totalAvailable:500,winLimit:"1/day",active:!1,icon:"lunch_dining",color:"#f2a60d"},{id:"p2",name:"10% Off",weight:50,totalAvailable:"unlimited",winLimit:"None",active:!0,icon:"local_offer",color:"#3b82f6"},{id:"p3",name:"Mystery Box",weight:5,totalAvailable:10,winLimit:"1/user",active:!0,icon:"inventory_2",color:"#8b5cf6"},{id:"p4",name:"Free Drink",weight:80,totalAvailable:"unlimited",winLimit:"None",active:!0,icon:"local_bar",color:"#10b981"},{id:"p_lose",name:"Better Luck Next Time",weight:20,totalAvailable:"unlimited",winLimit:"None",active:!0,icon:"mood_bad",color:"#64748b"}],lastCreatedRewardId:null,isLoading:!0},m=(a,b)=>{switch(new Date().toLocaleString(),b.type){case"SET_USER":return console.log("REDUCER: SET_USER",b.payload),{...a,currentUser:b.payload,activeRole:b.payload?.role||e.CUSTOMER,isLoading:!1};case"SET_LOADING":return console.log("REDUCER: SET_LOADING",b.payload),{...a,isLoading:b.payload};case"UPDATE_USER_POINTS":if(!a.currentUser)return a;return{...a,currentUser:{...a.currentUser,points:b.payload.points,spins:b.payload.spins}};case"ADD_LOG":return{...a,logs:[b.payload,...a.logs]};case"ADD_REWARD":return{...a,rewards:[b.payload,...a.rewards],lastCreatedRewardId:b.payload.id};case"MARK_REWARD_USED":return{...a,rewards:a.rewards.map(a=>a.code===b.payload?{...a,isUsed:!0}:a)};case"CLEAR_NEW_REWARD_FLAG":return{...a,rewards:a.rewards.map(a=>({...a,isNew:!1})),lastCreatedRewardId:null};case"SET_LOGS":return{...a,logs:b.payload};default:return a}},n=(0,d.createContext)(void 0),o=({children:a})=>{let[b,e]=(0,d.useReducer)(m,l);(0,d.useEffect)(()=>{},[]);let f=d.default.useMemo(()=>({logout:async()=>{await g.supabase.auth.signOut(),e({type:"SET_USER",payload:null})},grantSpinsByPublicId:async(a,b,c)=>{let d=await h(a,b,c);return d.success&&e({type:"ADD_LOG",payload:{id:`l-${Date.now()}`,timestamp:new Date().toLocaleString(),userId:a,userName:"Staff Member",userAvatar:"",action:"EARN_POINTS",details:`Earned ${d.pointsAdded} Points ($${c.toFixed(2)})`,publicId:b}}),d},earnPoints:async(a,b,c)=>{let d=await h(a,b,c);return d.success&&e({type:"ADD_LOG",payload:{id:`l-${Date.now()}`,timestamp:new Date().toLocaleString(),userId:a,userName:"Staff Member",userAvatar:"",action:"EARN_POINTS",details:`Earned ${d.pointsAdded} Points ($${c.toFixed(2)})`,publicId:b}}),d},convertPointsToSpins:async(a,b)=>{let c=await i(a,b);return c.success&&void 0!==c.newPoints&&void 0!==c.newSpins&&(e({type:"UPDATE_USER_POINTS",payload:{points:c.newPoints,spins:c.newSpins}}),e({type:"ADD_LOG",payload:{id:`l-${Date.now()}`,timestamp:new Date().toLocaleString(),userId:a,userName:"Customer",userAvatar:"",action:"CONVERT_POINTS",details:`Converted points to ${b} Spins`}})),c},spinWheel:async a=>{let b=await j(a);return b.ok&&(void 0!==b.newSpins&&void 0!==b.newPoints&&e({type:"UPDATE_USER_POINTS",payload:{points:b.newPoints,spins:b.newSpins}}),b.reward&&e({type:"ADD_REWARD",payload:{...b.reward,isNew:!0}}),e({type:"ADD_LOG",payload:{id:`l-${Date.now()}`,timestamp:new Date().toLocaleString(),userId:a,userName:"Customer",userAvatar:"",action:"SPIN",details:`Result: ${b.prize?.name||"No Win"}`}})),b},redeemCoupon:async(a,b)=>{let c=await k(a,b);return c&&(e({type:"MARK_REWARD_USED",payload:b}),e({type:"ADD_LOG",payload:{id:`l-${Date.now()}`,timestamp:new Date().toLocaleString(),userId:a,userName:"Staff Member",userAvatar:"",action:"REDEMPTION",details:`Redeemed Coupon: ${b}`}})),c},clearNewRewardFlag:()=>e({type:"CLEAR_NEW_REWARD_FLAG"}),setUser:a=>e({type:"SET_USER",payload:a}),setLoading:a=>e({type:"SET_LOADING",payload:a}),setLogs:a=>e({type:"SET_LOGS",payload:a})}),[e]);return(0,c.jsx)(n.Provider,{value:{state:b,actions:f},children:a})},p=(0,d.createContext)({loading:!0,session:null});function q({children:a}){let{actions:b}=(()=>{let a=(0,d.useContext)(n);if(!a)throw Error("useAppStore must be used within AppProvider");return a})(),[e,h]=(0,d.useState)(null),[i,j]=(0,d.useState)(!0),[k,l]=(0,d.useState)(!1);(0,d.useEffect)(()=>{if(k)return;l(!0),console.log("[Auth] Initializing...");let a=async()=>{try{let{data:{session:a},error:c}=await g.supabase.auth.getSession();if(c){console.error("[Auth] getSession error:",c),j(!1),b.setLoading(!1);return}h(a),a?.user?(console.log("[Auth] Session found, fetching profile for:",a.user.id),await m(a.user)):(console.log("[Auth] No session"),b.setUser(null),j(!1),b.setLoading(!1))}catch(a){console.error("[Auth] Init error:",a),j(!1),b.setLoading(!1)}},{data:{subscription:c}}=g.supabase.auth.onAuthStateChange(async(a,c)=>{console.log("[Auth] Event:",a),h(c),"SIGNED_IN"===a&&c?.user?(console.log("[Auth] SIGNED_IN, loading profile..."),await m(c.user)):"SIGNED_OUT"===a&&(console.log("[Auth] SIGNED_OUT"),b.setUser(null),j(!1),b.setLoading(!1))});return a(),()=>{c.unsubscribe()}},[k,b]);let m=async a=>{console.log("[Auth] loadProfile called for:",a.id,a.email),j(!0),b.setLoading(!0);let c=setTimeout(()=>{console.error("[Auth] Profile load timeout - unlocking UI"),j(!1),b.setLoading(!1)},8e3);try{console.log("[Auth] Calling rpc_get_my_profile...");let{data:d,error:e}=await g.supabase.rpc("rpc_get_my_profile");if(clearTimeout(c),console.log("[Auth] RPC result:",{data:d,error:e}),e){console.error("[Auth] RPC error:",e.message),console.log("[Auth] Trying direct query...");let{data:c,error:d}=await g.supabase.from("profiles").select("*").eq("id",a.id).single();if(console.log("[Auth] Direct query result:",{data:c,error:d}),c){let d={id:c.id,publicId:c.public_id,name:c.name||a.email?.split("@")[0],email:c.email||a.email,role:f(c.role),avatarUrl:`https://ui-avatars.com/api/?name=${c.email}&background=random`,points:c.points||0,spins:c.spins||0,joinedDate:new Date().toLocaleDateString()};console.log("[Auth] Profile loaded via direct query:",d.publicId),b.setUser(d)}else console.error("[Auth] No profile found!"),alert("Profile not found. Please contact support."),await g.supabase.auth.signOut(),b.setUser(null)}else if(d&&!d.error){let c={id:d.id,publicId:d.public_id,name:d.name||a.email?.split("@")[0],email:d.email||a.email,role:f(d.role),avatarUrl:`https://ui-avatars.com/api/?name=${d.email}&background=random`,points:d.points||0,spins:d.spins||0,joinedDate:new Date().toLocaleDateString()};console.log("[Auth] Profile loaded via RPC:",c.publicId,c.role),b.setUser(c)}else console.error("[Auth] RPC returned error:",d?.error),alert("Profile not found. Please try signing in again."),await g.supabase.auth.signOut(),b.setUser(null)}catch(a){console.error("[Auth] loadProfile exception:",a),b.setUser(null)}finally{j(!1),b.setLoading(!1)}};return(0,c.jsx)(p.Provider,{value:{loading:i,session:e},children:a})}function r({children:a}){return(0,c.jsx)(o,{children:(0,c.jsx)(q,{children:a})})}a.s(["Providers",()=>r],25792)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__0db0b21f._.js.map